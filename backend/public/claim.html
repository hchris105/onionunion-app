<!doctype html><meta charset="utf-8">
<title>認領/啟用帳號 - OnionUnion</title><meta name="viewport" content="width=device-width,initial-scale=1">
<style>body{font:16px/1.5 system-ui;margin:40px auto;max-width:520px}input{width:100%;padding:10px;margin:8px 0;border:1px solid #ddd;border-radius:8px}button{padding:10px 14px;border:0;border-radius:8px;background:#1f6feb;color:#fff}a{color:#1f6feb;text-decoration:none}</style>
<h2>認領 / 啟用預約帳號</h2>
<p>步驟：輸入 <b>帳號(handle)</b> 與 <b>對應的 WeChat</b>，設定新密碼。</p>
<form id="f">
  <input id="handle" placeholder="帳號（handle）" required>
  <input id="wechat" placeholder="Wechat" required>
  <input id="pwd" type="password" placeholder="新密碼（至少 8 字元）" minlength="8" required>
  <button type="submit">送出</button>
</form>
<p>已啟用過？<a href="/login.html">去登入</a></p>
<script>
document.querySelector("#f").onsubmit=async(e)=>{
  e.preventDefault();
  const handle=document.querySelector("#handle").value.trim();
  const wechat=document.querySelector("#wechat").value.trim();
  const new_password=document.querySelector("#pwd").value;
  const r=await fetch("/auth/claim",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({handle,wechat,new_password})});
  const j=await r.json().catch(()=>({}));
  if(!r.ok||!j.ok){alert(j.error||"認領失敗");return}
  // 後端若直接回 token，可在此存 JWT；否則導去登入頁
  if(j.token){ localStorage.setItem("JWT",j.token); location.href="/me.html"; }
  else{ location.href="/login.html?ok=1&identifier="+encodeURIComponent(handle); }
};
</script>
